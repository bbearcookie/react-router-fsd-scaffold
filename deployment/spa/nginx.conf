# 이 파일은 nginx 템플릿 파일입니다.
# Dockerfile 내 서버 스테이지에 정의된 ENV 변수들이 컨테이너 시작 시 envsubst로 치환됩니다.
# 따라서 이 파일에서는 ${VITE_BASE_NAME}, ${SPA_FALLBACK} 등의 환경 변수를 사용할 수 있습니다.

server {
    listen 80;
    absolute_redirect off;
    root /usr/share/nginx/html;
    
    # 기본 경로 처리
    location ${VITE_BASE_NAME} {
        try_files $uri $uri/index.html /${SPA_FALLBACK};
    }

    # 다국어 파일 등 JSON 서빙 (10분 캐싱)
    location ~* \.(json)$ {
        add_header Cache-Control "public, max-age=600";
    }

    # 정적 파일 서빙 (1년 캐싱)
    location ~* \.(js|css|png|jpg|jpeg|gif|svg|webp|ico|ttf|woff2|woff|eot|otf)$ {
        add_header Cache-Control "public, max-age=31536000, immutable";
    }

    # HTML 파일 캐시 비활성화
    location ~* \.html$ {
        add_header Cache-Control "no-store, no-cache, must-revalidate, proxy-revalidate, max-age=0" always;
    }
}
